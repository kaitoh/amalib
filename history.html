<html>
<head><title>AmaLib Options</title></head>
<script type="text/javascript">

function get_ls_asin_list() {
    if(localStorage["asin_list"] == undefined) {
        return [];
    } else {
        return JSON.parse(localStorage["asin_list"]);
    }
}
function set_ls_asin_list(list) {
    localStorage["asin_list"] = JSON.stringify(list);
}

function show_asin_log() {
    var d = document.getElementById("asin_log_div");
    var asin_list = get_ls_asin_list();

    d.innerHTML = "";
    for(var i = 0 ; i < asin_list.length ; i++) {
        if( asin_list[i].log != undefined ) {
            d.innerHTML += "<input type=checkbox name=cb value="+ asin_list[i].asin + ">"
            d.innerHTML += "<img src=" + asin_list[i].log.icon + " width=20px height=20px >";
            d.innerHTML += "<a href=" + asin_list[i].url + ">" + asin_list[i].title + "</a>";
            d.innerHTML += " :   " + asin_list[i].log.tooltip;
            // d.innerHTML += " :[" + asin_list[i].log.date+"]";
            d.innerHTML += "<br>";
        }
    }
}

function search_asin(a, asin) {
    for(var i = 0 ; i < a.length ; i++) {
        if(a[i].asin == asin) { 
            return i;
        }
    }
    return -1;
}

function force_clear_log() {
    delete localStorage.asin_list;
}

function delete_asin_list() {
    var asin_list = get_ls_asin_list();
    var cb = document.getElementsByName("cb");

    for(var i = 0 ; i < cb.length ; i++) {
        if( cb[i].checked != false ) {
            var pos = search_asin(asin_list, cb[i].value);
            if( pos != -1 ) {
                asin_list.splice(pos, 1);
            }
        }
    }
    set_ls_asin_list(asin_list);
    show_asin_log();
}

function onload() {
    show_asin_log();
}
</script>

<body onload="onload()">

History:
<div id="asin_log_div">
</div>
<br>

<button onclick="delete_asin_list()">delete</button>
<br>
<br>
<br>
<button onclick="force_clear_log()">delete All</button>

</body>
</html>
